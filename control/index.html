<html lang="es">
    <head>
        <title>Control</title>
        <script type="application/javascript">

            let content = [

                    {a:'eCUyMCUyMjklMjAlNUIlMjBiJTIwXyUyMG0lMjBnJTIwYSUyMCUyM1glMjBfJTIwJTIyNyUyMEMlMjAlNUQ=',b:'WiUyMCUyMiklMjBGJTIwSCUyME0lMjBLJTIwRSUyMEslMjAlMjNIJTIwJTVD'}
                    ,{a:'JTIyJTI2JTIwJTIyJTNDJTIwMiUyMCU1RCUyMGwlMjBnJTIwJTVCJTIwbg==',b:'JTVCJTIwJTIyJTI1JTIwRSUyMEklMjBOJTIwYiUyMCUyMiolMjAlMjIlMjQlMjAlMjNH'} 
                    ,{a:'JTIyQSUyMCUyMmclMjB3JTIwJTIyKCUyMGglMjAlMjIq',b:'JTIyNCUyMCUyMiUyNCUyMCU0MCUyMFUlMjB4JTIwJTdDJTIwdiUyMHklMjAlMjMlN0MlMjAlMjIz'}
                    ,{a:'JTIyOSUyMCUyMmIlMjAlMjIlMjYlMjB5JTIwJTIyJTI2JTIwJTIyKiUyMGYlMjAlMjIlMjUlMjAlMjQlMkMlMjAlMjItJTIwJTIyXyUyMCUyMiUyNiUyMCUyMiUyNSUyMCUyMiUyMiUyMCUyMio=',b:'JTIyQiUyMCUyMmUlMjAlMjIhJTIwJTIyJTI2JTIwSSUyMEklMjBHJTIwdSUyMCUyMyU3RCUyMCUyMiUzQiUyMCUyMiUyNSUyMEMlMjBoJTIwZg=='}
                    ,{a:'XyUyMCUyMiUyMyUyMEolMjBJJTIwdSUyMEslMjAlNDAlMjBIJTIwJTIzXyUyMHglMjAlMjI5JTIwJTVCJTIwYiUyMF8lMjBtJTIwZyUyMGE=',b:'bSUyMCUyMiUyNSUyMEolMjBsJTIwJTYwJTIwJTIyJTIzJTIwJTIyJTIyJTIwJTVDJTIwJTIzYiUyMCUyMi4='}
                    ,{a:'JTIyJTQwJTIwJTIyVyUyMCUyMiUyNiUyMEElMjAlMjIhJTIwJTdEJTIwZSUyMCUyMiUyNA==',b:'YyUyMCUyMiolMjBHJTIwTCUyMEclMjBNJTIwRSUyMEo='}
                    ,{a:'JTIyJTQwJTIwJTIyVyUyMCUyMiUyNiUyMEElMjAlMjIoJTIwJTIyMiUyMGUlMjAlMjIlMjQ=',b:'XyUyMCUyMiUyQiUyMEMlMjBHJTIwTyUyMFAlMjBlJTIwJTIyKg=='}
                    ,{a:'JTIyJTQwJTIwJTIyWCUyMCUyMiclMjBBJTIwJTIyISUyMCU3RCUyMFUlMjB5',b:'JTVCJTIwJTIyaSUyMHMlMjAlMjIlMjQlMjBfJTIwJTIyKCUyMCUyMiUyNCUyMHklMjAlMjQqJTIwJTIyMSUyMCUyMm0='}
                    ,{a:'JTIyJTQwJTIwJTIyWCUyMCUyMiclMjBBJTIwJTIyKCUyMCUyMjIlMjBVJTIweQ==',b:'JTVCJTIwJTIyJTI2JTIwRyUyMEwlMjBHJTIwTCUyMCU1QiUyMCUyMiUyNg=='}
                    ,{a:'JTIyLSUyMCUyMmclMjAlMjIuJTIwJTdEJTIwZiUyMCUyMic=',b:'JTIyRiUyMCUyMiElMjAlM0YlMjBFJTIwRyUyMEslMjBFJTIwSSUyMCUyM04lMjB6'}        
                    ,{a:'ayUyMCUyMkclMjAlM0YlMjAlMjIlMjYlMjAlMjIlMkYlMjAlN0QlMjBl',b:'JTVEJTIwJTIyKCUyMEolMjB5JTIwVyUyMG0lMjBDJTIwRg=='}
                    ,{a:'VyUyMCUyMmMlMjAlN0IlMjAlMjIlMjQlMjBkJTIwJTVC',b:'JTVEJTIwJTIyKCUyMEolMjBF'}
                    ,{a:'VyUyMCUyMmMlMjAlMjIlMkIlMjB4JTIwZCUyMCU1Qg==',b:'JTVCJTIwJTIyJTI2JTIwRyUyMEwlMjBHJTIwTCUyMCU2MCUyMHY='}
            ]
                ;


            function encrypt(text, pwd) {
                let textLen = text.length;
                let pwdLen = pwd.length;
                let sep = getSplitIndex(textLen, pwd);
                let splitText = text.substring(sep) + text.substring(0, sep);
                let encArr = [];
                for (let i = 0; i < textLen; i++) {
                    encArr.push(encChar(splitText.charAt(i), pwd.charAt(i % pwdLen)));
                }
                let enc = encArr.join(' ');
                let safeEnc = encodeURIComponent(enc);
                let safeEncB64 = btoa(safeEnc)
                return safeEncB64;
            }

            function encChar(decChar, pwdChar) {
                let asciiDec = decChar.charCodeAt(0) - 32;
                let caesarSteps = pwdChar.charCodeAt(0) - 32;
                let asciiEnc = asciiDec + caesarSteps;
                let baseAscii = toBaseAscii(asciiEnc);
                return baseAscii
            }

            function decChar(encChar, pwdChar) {
                let caesarSteps = pwdChar.charCodeAt(0) - 32;
                let asciiEnc = toNumFromBaseAscii(encChar.trim());
                let asciiDec = asciiEnc - caesarSteps;
                return String.fromCharCode(asciiDec + 32);
            }

            function toBaseAscii(num) {
                let n = Math.trunc(num / 94)
                let res = num % 94;
                let prefix = '';
                if (n >= 1) {
                    prefix = toBaseAscii(n);
                }
                return prefix + String.fromCharCode(res + 33);
            }

            function toNumFromBaseAscii(ascii) {
                let num = 0;
                for (let pos = ascii.length - 1; pos >= 0; pos--) {
                    let pow = ascii.length - pos - 1;
                    num += (ascii.charCodeAt(pos) - 33) * Math.pow(94, pow)
                }
                return num;
            }

            function decrypt(b64, pwd) {
                let pwdLen = pwd.length;
                let safeEnc = atob(b64);
                let enc = decodeURIComponent(safeEnc);
                let encArr = enc.split(' ');
                let splitText = '';
                for (let i = 0; i < encArr.length; i++) {
                    splitText += decChar(encArr[i], pwd.charAt(i % pwdLen));
                }
                let sep = getSplitIndex(splitText.length, pwd);
                sep = splitText.length - sep;
                let text = splitText.substring(sep) + splitText.substring(0, sep);
                return text;
            }

            function getSplitIndex(textLen, pwd) {
                let sum = 0;
                for (let i = 0; i < pwd.length; i++) {
                    sum += pwd.charCodeAt(i) - 31;
                }
                let sep = (sum % (textLen - 1)) + 1;
                return sep;
            }

            function login() {
                let pwd1 = document.getElementById('pwd1').value;

                let counter = 0;
                let code = content.map(item => {
                    let text1 = decrypt(item.a, pwd1);
                    return {
                        text1: text1,
                        enc: item.b
                    };
                }).sort((a, b) => {
                    return a.text1.localeCompare(b.text1);
                }).map(text1AndEnc => {
                    counter++;
                    let text1 = text1AndEnc.text1;

                    return `
                         <div>&nbsp;</div>
                        <div>
                                <input type="button" value="&#128203;" id="btnClipA${counter}" data-c="${text1}" />
                                <input type="button" value="&#128203;" id="btnClipB${counter}" data-c="${text1AndEnc.enc}"/>
                                ${text1}
                        </div>
                    `;
                }).join('');

                document.getElementById('divControl').innerHTML = code;
                for (let i = 1; i <= counter; i++) {
                    document.getElementById(`btnClipA${i}`).addEventListener('click', (event) => {
                        let data = event.target.getAttribute('data-c');
                        copyToClipBoard(data);
                    });
                    document.getElementById(`btnClipB${i}`).addEventListener('click', (event) => {
                        let pwd2 = document.getElementById('pwd2').value;
                        let data = decrypt(event.target.getAttribute('data-c'), pwd2);
                        copyToClipBoard(data);
                    });
                }

            }

            function copyToClipBoard(data) {
                navigator.clipboard.writeText(data).then(() => {
                    console.log('Text copied to clipboard');
                }).catch((error) => {
                    console.error('Could not copy text: ', error);
                });
            }

            function init() {
                console.log('init');
                document.getElementById('btnEnter').addEventListener('click', () => {
                    login();
                });
                document.getElementById('pwd1').addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        login();
                    }
                });
                document.getElementById('pwd2').addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        login();
                    }
                });
                document.getElementById('btnEncode').addEventListener('click', () => {
                    let text1 = document.getElementById('text1').value;
                    let text2 = document.getElementById('text2').value;
                    let pwd1 = document.getElementById('pwd1').value;
                    let pwd2 = document.getElementById('pwd2').value;
                    let enc1 = encrypt(text1, pwd1);
                    let enc2 = encrypt(text2, pwd2);
                    let txt = `{a:'${enc1}',b:'${enc2}'}`;

                    document.getElementById('encodedText').value = txt;
                });
                document.getElementById('btnCopyEncodedText').addEventListener('click', () => {
                    let txt = document.getElementById('encodedText').value;
                    copyToClipBoard(txt);
                });
                document.getElementById('btnShowEncoder').addEventListener('click', () => {
                    document.getElementById('divEncoder').classList.remove('hidden');
                });

                //setTimeout(() => location.reload() , 1000 * 60 * 2);
            }
        </script>

        <style type="text/css">
            #divControl{
                width: 600px;
                margin: auto;
            }
            .credentials{
                width: 600px;
                margin: auto;
            }
            .encoder {
                width: 600px;
                margin: auto;

            }
            .hidden {
                display: none;
            }
            input {
                padding-left: 5px;
                padding-top: 5px;
                padding-bottom: 5px;
            }
        </style>
    </head>
    <body>
        <div id="divAccess"  >
            <div class="credentials">
                <label><input type="password" id="pwd1"></label>
                <label><input type="password" id="pwd2"></label>

                <button id="btnEnter">Enter</button>
                <button id="btnShowEncoder"> &#128273;</button>
            </div>
            <div>&nbsp;</div>
            <div id="divEncoder" class="encoder hidden">
                <label><input type="text" id="text1"></label>
                <label><input type="password" id="text2"></label>
                <button id="btnEncode">Encode</button>
                <br><br>
                <label>
                    <input type="text" id="encodedText" style="width: 500px" >
                    <input type="button" id="btnCopyEncodedText" value="&#128203;"/>
                </label>
            </div>
        </div>


        <div id="divContent"  >
            <div id="divControl"  >
            
            </div>
        </div>

        <script type="application/javascript">
                init();
        </script>
    </body>
</html>
