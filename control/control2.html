<html lang="es">
    <head>
        <title>Control</title>
        <meta name=viewport content="width=device-width" />
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <script type="application/javascript">



            let content = [
{"a":"6x))EK/},8-y%5h^y,#f};(irm,E>vq?MH","b":"$#Gr{KZ1,$Yv(7Fbe,|pIS`Uih","c":"$&4K0Frd,2[#H?_ZC,7i/O1tdq,7jVlAvzG,..A8O&;S,)0[JLF<L,&SXWG","d":")s`jPYO+,2N*P)qzA,:pU7M[L;,7`R3r%=o,7`fXTKDn,8]Lu1.OD,7#$Z0Z7V,}BZB`>|I,e"}
,{"a":")R)6I=6],7eRP0EK_,7##=I7BE,7mI:{F:O","b":"%r[5QUa.,9-H>fXzg,|pbqayDx","c":"&dNyk|$(,7UA|$a=/,0<EpZ7.a,#aIy6)Z{,)^o;ULLg,+n|tQFzA,|","d":"$)!v-g=4,0=$t-/f@,1dl{4=^h,4hDEm<uv,-JNY3}v@,-K6>jI~h,r7gixX;"}
,{"a":"&4R)?Fm~,7]NvHiM7,$||`mtW#,7~+{O]bC,%","b":"0(3LX>!C,#e[V|lAd,7gPgd;:z,%","c":"&2+dORli,7]%#A5=R,3X9.Fb>a,$x_MYb7.,}AN-Y{Qg,#n}InH4!,$W6]","d":"1u4;!t^m,$(zzDe^f,}CVs`i^i,2Qq8R/)7,%ItzC)tM,0=cY?oYz,#UdEJ$h"}
,{"a":"}Bi5y-Qs,%gECjLEZ,./P+O5sw,}G415OiR,|)","b":"}Vxbv<z!,}G>lAu&y,{6*5/","c":"$W-hdX]S,7inG[Y5S,}<i4-xoS,8%Z!Aw=w,8S_iqB$H,7`iPaxHZ","d":"/>2ri%6&,8(b%Ih%w,{rX8M[k/,7|xMnm&%,5*>l;O6U,#Pxf}f:"}
,{"a":"&0A+?2<(,8>bb8h:1,%ogLr}z#,7w0eq>O8,|","b":"+kk4Rdtm,#U:m;{x1,I1>0<b_","c":"#u#K!gKh,}B3?y{ib,}Cv[DSjj,7|dDfJZk,2S4y+fPU,(%wutP$F,8-wK&aK^,7Yjds0t1,&1C.e","d":"%DI|vqi$,7j3paGC.,#f<[4ZP%,$Dwln&IY,7t@2MP%v,6F8k{kO+,1BkbL*tm,#}y"}
,{"a":"0}FD3o[_,7~+-Gd>h,7^SF(H$&,4g_nVI%K","b":"(6]mYpJe,*mRLrPf%,.es3xMLb","c":"&IP1}PVO,7]cu0>0$,0@}XAs7v,(z8`eU<y,2MI_+p-{,7~5W661/,+gHpy~~1,#k6#n?on,2|","d":"#V.Xw&6k,;M.Jl/jm,%zxVZx$b,8LaP@5|$,7UKRI=11,;Mg>Af-Z,|pq"}
,{"a":"7?a8*&LG,)Vwf&pNy,#URII+1S,)0QYg*Bn","b":"&V*4zg(q,7i%#0-m6,%{46q~dD,)","c":"#bo}Zg~y,}YfUX5u[,}T76/[O[,$@fB}l0e,7^h;nG:r,;Mh-B:5[,-lNq&X|y,6VwOU>jm,}QF9","d":"&1dD8T2@,4hh5F7DE,7$i[%R%[,*~vPBsp5,7eqyR^i3,7hK5m]b&,&S9pN"}
,{"a":"#bm6OwhH,)W9dmM69,7WT;SFzL,;R*kT?yx","b":"%A[#]o^q,}@ykO`#s,(6j?DCr@,|T","c":"%f|-Y[>9,7~UCY|g4,0Ea-7!Dk,7ngarALd,;Hd)kTZ=,#aI@X{_7,}_|TWQjj,*","d":"$QUG=kNS,7see]mI0,%2`6o+;/,%}k:{1Ow,(YIIqX!a,4iSRHR`),|^+"}
,{"a":"$z*^V1=I,7c[PXIda,$DwbK0!_,|JZ96EKc","b":"3X&!/6(A,+V]<;ta+,^YHy/h","c":"$7#1I}`y,1BmK`(N1,%=Ii;IRt,+kz}p!pI,0>4CE!(b,7]:&<.q0,A-GA","d":"$0!;k@eD,7ZVjSRpp,}B`MNNy/,#UAVxbgR,$-S}2(l{,7Vz2XajF,7spHSxdl,|7y"}
,{"a":"&S^Bt]Zt,9|]rHxWC,(zW;3OLI,&1dObKoZ,&","b":"%ogb4Cao,8WqAe[=;,2RPyR0qG","c":"*~fr&Cp>,7]DIW3{d,6g9GbbL=,$QVcF4FI,2N*Kap~U,*me","d":"&?bI0T$=,4Rxg4w(e,+gX5;z%.,4R<Jclh1,z87+WL*"}
,{"a":"0Csi2EKa,%{[:n!`y,-lmJv#iO,/L3]FA","b":"#u#3QB4@,7sp]>Kas,{0N;sPl","c":"#l~x81yR,7ZLf`c6),7$!+[-1[,&(!jm.wC,#K(+6$vR,$W#S","d":"$z-SbyXU,&JsUJs{B,}A.^VfwR,&2K5qvL%,%%^WJ&}R,4ca3pgcz,{"}
,{"a":"0}NEC?)R,%+m%BW(e,+$J<Frs:,#!iR(gDZ","b":"#W~Dyl+;,7|oegREy,7V:t}lLz,#","c":"1dFw&ILY,8g:6mrzh,89-9drY@,7`Q[c<HA,7^]kR__6,|#Mbw","d":"%DHa*F[4,.)RHYV<%,$8CG(*4f,4gF.}&Es,#R*Nr%_7,%|s_<>zd,)}H3rV"}
,{"a":"&#hO!9W+,$FB$5yoU,7+F[DK:q,2R&zu1xI,#G","b":"}RnSnkBA,#vj*HH3D,8zm|c)8$","c":"&2u4ch!a,+m/lRSNT,95lG]EMg,%ezk^l4%,%yU}0N2U,|e","d":"6V_9_AG6,2R}nrzy+,$b>#9..I,&-SStQ/$,7boA[9$$,4s2Yf$*1,%~Ip"}
,{"a":"(%pvhwkw,9*Z2Cgcg,0YaR}3iL,)pHn+I","b":")t|6n0qv,-JPj%y%g,:m8#dIt","c":"+g~@fh_g,/Nw8.gm7,$pfll0Q#,7]D[){M3,8c+/mrHA,I=JG","d":"}Yf>bIBm,$^1Fm!MV,0=a!A#1S,%((s!>8F,}ANRx93Y,:~SId"}
,{"a":"$s*%;8`U,%c3ce40d,7k.BIP&M,%-V>P`Q7,_","b":"&.vj>}6(,7|cSRtU.,|nSZ#o/;","c":"+V`H{#c#,7kM=UG%c,7[F2;`%v,6$/LiB$#,9{}<HQ1V,|K7yd*|2","d":"$Dx>Slee,7xU7~Y?#,8$0^r/]*,7eH}!-y;,;Tr#S^Iv,9vQP|}DA,#/2"}
,{"a":";Of~ZIB7,7V&5eb$*,+l<r~$M2,aO+9|l)","b":"}UUL1E1:,;UvBy;[.,+5w?IkQ0","c":"/O%t8>L@,*;8-#{t=,$423hDzV,.)Vkj<<&,+l>^Zt^e,+54hkf$^,$W#S","d":"&1i&NnQ+,$jgRwYT1,$gt&&%*),;Pd|swB{,}AN-fQ3.,$pg3dF+[,|w"}
,{"a":"%@8[:nwO,6$=7Wwow,{r5~)quV,#Tpoaop","b":"$NdD7h[2,2VSn8h$=,%)oqlbx!,%","c":"12Oalt].,&C)#_z]_,7t+8h%yR,.|p88%?(,7Tq}LcRy,$YvAOmy[,.fqh=Gd","d":"#lZK*ts7,%f$Nh-?$,7ci/td)z,7[1h<9)y,0<RzKxGC,#P]oU~s<,}K6]V"}
,{"a":"%zx>y$dh,.})Ap4og,0ErHjY+/,4-G4nz","b":".DO#D/(y,$i>d5>@n,)[.=z!=5,*","c":"$2hT[]I=,)W1RxLN%,$}YCjl%Z,91^~)V3z,7p2MY7xX,|14H)!@","d":"$=y1z>:p,7h@1ff:e,(yjRu]7`,7e~yxkW.,-)pj2Fmv,}=#=7%?+,>U3V2+b"}
,{"a":"$T?w|yMs,1Bmwk/NC,7}sSG(}J,/1%8]0g","b":"$Kvp{Qj@,7eGy{>?R,-[?PJ]FA,F","c":"&C<^GLrj,7|OKLz+5,7]D^CL$A,(&H2]gSg,#aIm4ZH2,+vFO5iR@,3GKu~uvt,#/r","d":"#K*g-dfX,7[p91a-R,(H.zG.Vd,*;60#])3,7[[1oP<@,(iR!lXng,)VZ}]6iw,1;a131a"}
,{"a":"}YlhQRKY,0=g+4s:@,-kxO(5LE,|yuRJ~lg","b":"$us66Ktm,&L<dS9kt,#|Q|no#d","c":"4bl$L<.=,%ojb_eo5,8u7`vHBa,&#k3O!bO,8/@Zc[~I,c*8","d":"#k6!qXV@,8kNR;*2G,7id|]0TH,7]NzJa.f,7XGk].h@,&2*;M6Av,|8"}


            ];

            function getRandomToken() {
                let rndToken = "";
                for (let i = 0; i < 12; i++) {
                    const rnd = Math.floor(Math.random() * (126 - 33 + 1)) + 33;
                    rndToken += String.fromCharCode(rnd);
                }
                return rndToken;
            }

            function intArrayToStringBaseAscii(arr) {
                let base11 = arr.join(',').replaceAll(',', 'a').replaceAll('0', 'b');
                //console.log(`base11 ${base11}`)
                return splitByBlocks(base11, 14)
                    .map(block => {
                        let blockAsNum = parseInt(block, 12);
                        let blockAsAscii = toBaseAscii2(blockAsNum)
                        //console.log(`block ${block} [${blockAsNum}] [${blockAsAscii}]`)
                        return blockAsAscii;
                    })
                    .join(',');

            }

            function stringBaseAsciiToIntArray(text) {
                return text.split(',')
                    .map(blockAsAscii => {
                        let blockAsNum = toNumFromBaseAscii2(blockAsAscii);
                        let block = blockAsNum.toString(12);
                        //console.log(`block ${block} [${blockAsNum}] [${blockAsAscii}]`)
                        return block; 
                    })
                    .join('')
                    .split('a')
                    .map(numAsText => parseInt(numAsText.replaceAll('b', '0')));

            }


  
            function splitByBlocks(text, size) {
                const blocks = [];
                for (let i = 0; i < text.length; i += size) {
                    blocks.push(text.slice(i, i + size));
                }
                return blocks;
            }
 

            function toBaseAscii2(num) {
                let n = Math.trunc(num / 90)
                let res = num % 90;
                let prefix = '';
                if (n >= 1) {
                    prefix = toBaseAscii2(n);
                }
                return prefix + String.fromCharCode(res + 33)
                    .replaceAll("'", '}')
                    .replaceAll('"', '|')
                    .replaceAll(',', '{')
                    .replaceAll('\\', '~');
            }

            function toNumFromBaseAscii2(ascii) {
                ascii = ascii
                    .replaceAll('{', ',')
                    .replaceAll('|', '"')
                    .replaceAll('}', "'")
                    .replaceAll('~', '\\');
                let num = 0;
                for (let pos = ascii.length - 1; pos >= 0; pos--) {
                    let pow = ascii.length - pos - 1;
                    num += (ascii.charCodeAt(pos) - 33) * Math.pow(90, pow)
                }
                return num;
            }




            function login() {
                let pwd1 = document.getElementById('pwd1').value;


                Promise.all(
                    content.map((item, idx) => decryptData(pwd1, item).then(value => { return {value: value, index: idx}} ))
                ).then(values => 
                    values.sort((a, b) => {
                        return a.value.localeCompare(b.value);
                    }).map(text => 
                        `
                        <div>&nbsp;</div>
                        <div class="cred-item">
                                <input type="button" value="&#128203;" id="btnClipA${text.index}" class="btn" data-c="${text.value}" />
                                <input type="button" value="&#128203;" id="btnClipB${text.index}" class="btn" data-c="${text.index}"/>
                                ${text.value}
                        </div>
                        `
                    ).join('')    
                ).then(code => {
                    document.getElementById('divControl').innerHTML = code;
                    for (let i = 0; i < content.length; i++) {
                        document.getElementById(`btnClipA${i}`).addEventListener('click', (event) => {
                            let data = event.target.getAttribute('data-c');
                            copyToClipBoard(data);
                        });
                        document.getElementById(`btnClipB${i}`).addEventListener('click', (event) => {
                            let pwd2 = document.getElementById('pwd2').value;

                            let index = parseInt(event.target.getAttribute('data-c'));
                            let aux = content[index];
                            let encData = {
                                a: aux.a,
                                b: aux.b,
                                c: aux.d
                            }

                            decryptData(pwd2, encData)
                                .then(data => copyToClipBoard(data));

                        });
                    }
                });
                setTimeout(() => location.reload() , 1000 * 60 * 2);
            }

            function copyToClipBoard(data) {
                navigator.clipboard.writeText(data).then(() => {
                    console.log('Text copied to clipboard');
                }).catch((error) => {
                    console.error('Could not copy text: ', error);
                });
            }

            function init() {
                console.log('init');
                document.getElementById('btnEnter').addEventListener('click', () => {
                    login();
                });
                document.getElementById('pwd1').addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        login();
                    }
                });
                document.getElementById('pwd2').addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        login();
                    }
                });
                document.getElementById('btnEncode').addEventListener('click', () => {
                    let text1 = document.getElementById('text1').value;
                    let text2 = document.getElementById('text2').value;
                    let pwd1 = document.getElementById('pwd1').value;
                    let pwd2 = document.getElementById('pwd2').value;
                    encryptData(pwd1, pwd2, text1, text2, txt => document.getElementById('encodedText').value = txt)
                });
                document.getElementById('btnCopyEncodedText').addEventListener('click', () => {
                    let txt = document.getElementById('encodedText').value + "\n";
                    copyToClipBoard(txt);
                });
                document.getElementById('btnShowEncoder').addEventListener('click', () => {
                    document.getElementById('divEncoder').classList.remove('hidden');
                });
                document.getElementById('btnGenRamdom').addEventListener('click', () => {
                    let rndToken = getRandomToken();
                    document.getElementById('text2').value = rndToken;
                    document.getElementById('rndTokenText').innerText = rndToken;

                });
                  document.getElementById('btnCopyRandom').addEventListener('click', () => {
                    copyToClipBoard(document.getElementById('text2').value)
                    document.getElementById('rndTokenText').innerText = '';

                });

                //setTimeout(() => location.reload() , 1000 * 60 * 2);
            }


            function generateKeyFromPassword(password, salt) {
                const encoder = new TextEncoder();
                return window.crypto.subtle.importKey(
                    "raw",
                    encoder.encode(password), {
                        name: "PBKDF2"
                    },
                    false,
                    ["deriveKey"]
                ).then(keyMaterial =>
                    window.crypto.subtle.deriveKey({
                            name: "PBKDF2",
                            salt: salt,
                            iterations: 100000,
                            hash: "SHA-256",
                        },
                        keyMaterial, {
                            name: "AES-GCM",
                            length: 256
                        },
                        true,
                        ["encrypt", "decrypt"]
                    )
                );
            }

            function encryptData(password1, password2, data1, data2, consumer) {
                const salt = window.crypto.getRandomValues(new Uint8Array(16));
                const iv = window.crypto.getRandomValues(new Uint8Array(12));
                let a = intArrayToStringBaseAscii(Array.from(salt));
                let b = intArrayToStringBaseAscii(Array.from(iv));

                //console.log(`salt ${Array.from(salt)}`);
                //console.log(`iv   ${Array.from(iv)}`);

                encryptData0(password1, data1, salt, iv)
                    .then(encrypted1 => {
                        encryptData0(password2, data2, salt, iv)
                            .then(encrypted2 => {
                                let rs = {
                                    a: a,
                                    b: b,
                                    c: encrypted1,
                                    d: encrypted2
                                }
                                consumer(JSON.stringify(rs));
                            });
                    })

            }

            function encryptData0(password, data, salt, iv) {
                return generateKeyFromPassword(password, salt)
                    .then(key =>
                        window.crypto.subtle.encrypt({
                                name: "AES-GCM",
                                iv: iv
                            },
                            key,
                            new TextEncoder().encode(data)
                        )
                    )
                    .then(encrypted => {
                        let arr = Array.from(new Uint8Array(encrypted))
                        //console.log(`encrypted   ${arr}`);
                        let encoded = intArrayToStringBaseAscii(arr);

                        testEncryptedData(password, salt, iv, encoded, data);
                        return encoded;
                    });
            }

            function testEncryptedData(password, salt, iv, encrypted, expected) {
                let encryptedObject = {
                    a: intArrayToStringBaseAscii(Array.from(salt)),
                    b: intArrayToStringBaseAscii(Array.from(iv)),
                    c: encrypted
                }
                decryptData(password, encryptedObject)
                    .then(decrypted => {
                        if(decrypted != expected) {
                            alert(`An error occurred testing encription. decryptData_[${decrypted}]_expected_[${expected}]`);
                        }
                    }).catch(ex => {
                        alert('An error occurred testing encription');
                        console.error(ex);
                    });
            }



            function decryptData(password, encryptedObject) {
                const salt = new Uint8Array(stringBaseAsciiToIntArray(encryptedObject.a));
                const iv = new Uint8Array(stringBaseAsciiToIntArray(encryptedObject.b));
                const encryptedData = new Uint8Array(stringBaseAsciiToIntArray(encryptedObject.c));

                //console.log(`password  [${password}]`);
                //console.log(`salt            ${Array.from(salt)}`);
                //console.log(`iv              ${Array.from(iv)}`);
                //console.log(`encryptedData   ${Array.from(encryptedData)}`);

                return generateKeyFromPassword(password, salt)
                    .then(key =>
                        window.crypto.subtle.decrypt({
                                name: "AES-GCM",
                                iv: iv
                            },
                            key,
                            encryptedData
                        )
                    ).then(decrypted => new TextDecoder().decode(decrypted))
                    .catch(ex => {
                        return Array.from(window.crypto.getRandomValues(new Uint8Array(6))).map(n => toBaseAscii2(n)).join('');
                    });
            }


        </script>

        <style type="text/css">
            #main-container {
                width: 100%;
                margin: 0px;
                padding: 0px; 
               
            }
            .container {
                max-width: 400px;
                width: 90vw;
                margin: auto;
                text-align: center;
            } 
            .hidden {
                display: none;
            }
            .text-field {
                padding-left: 5px;
                padding-top: 5px;
                padding-bottom: 5px;
                width: 90%;
                max-width: 200px;
                height: 40px;
                font-size: 1.5rem;
                margin-bottom: 10px;
                border-radius: 10px;
                border: 1px solid #dadada;
            }
            .hidden-text {
                -webkit-text-security: disc;
                text-security: square;
            }
            .cred-item {
                text-align: left;
                padding-left: 20px;
            }
            button, .btn {
                padding-left: 30px;
                padding-right: 30px;
                padding-top: 10px;
                padding-bottom: 10px;
                font-size: 1.0rem;
                border-radius: 7px;
                border: 1px solid #dadada;
            }
            
            button:active { background: #0068c0 }
            .btn:active { background: #0068c0 }
        </style>
    </head>
    <body>
        <div id="main-container"  >
            <div class="container">
                <p>&nbsp;</p>
                <label><input type="text" id="pwd1" autocomplete="off" class="hidden-text text-field" ></label>
                <label><input type="text" id="pwd2" autocomplete="off" class="hidden-text text-field"></label>
                <p></p>
                <button id="btnEnter">Enter</button>
                <button id="btnShowEncoder"> &#128273;</button>
            </div>
            <div>&nbsp;</div>
            <div id="divEncoder" class="container hidden">
                <label><input type="text" id="text1" autocomplete="off" class="text-field"></label>
                <label><input type="text" id="text2" autocomplete="off" class="text-field hidden-text" ></label>
                <p id="rndTokenText"></p>
                <button id="btnGenRamdom" >Rnd</button>
                <button id="btnCopyRandom" >&#128203;</button>
                <button id="btnEncode">Encode</button>
                <br><br>
                <label>
                    <input type="text" id="encodedText" class="text-field" >
                    <p></p>
                    <button id="btnCopyEncodedText" >&#128203;</button>
                </label>
            </div>
            <div id="divControl" class="container"></div>
        </div>




        <script type="application/javascript">
                init();
        </script>
    </body>
</html>